# ProjectBS S63 WebGL - Part 1

## 프로그래밍 일반

### 레이어(Layer, 계층)

복잡함을 해결하기 위한 전략 중의 하나

![](http://i.imgur.com/zHbhxAk.png)

A계층은 직접 접하고 있는 B계층에 대해서만 알면 되고, C계층에 대해서는 알지도 못하며 교류하지도 않는다.

### Interface, Protocol

상호작용(interaction)을 하기 위한 무엇.
계층간 상호작용을 할 수 있게 해주는 규약.

### 상대주의적 관점

아래의 관계에서 B는 상황에 따라 상대적으로 정보의 소비자이기도 하고 정보의 제공자이기도 하다.

- A는 정보 제공자, B는 A가 제공하는 정보의 소비자
- B는 정보 제공자, C는 B가 제공하는 정보의 소비자

따라서 (가)는 언제나 (나)이다. 라는 절대주의적 관점을 버리고 항상 상황에 따라 상대주의적으로 파악하는 것이 프로그래밍의 이해에 도움이 된다.

### 용어는 고유명사

일반적으로 통용되는 의미에 너무 구속되면 내용 이해에 방해가 되므로 프로그래밍 관련 용어는 아예 별개의 고유명사로 인식하는 것이 좋다. 

- domain(앞 뜰 - 문제 영역), table(탁자, 표 - 데이터베이스 테이블), ...

## 컴퓨터의 그래픽 처리 흐름

### 물리적 흐름

![](http://i.imgur.com/F8riypr.png)


## WebGL은 왜 빠른가?

사용자의 눈높이는 점점 높아지고, 디바이스의 사양은 (역설적으로?) 계속 낮아지고 있다.
- 하드웨어 자체는 점점 좋아지지만, 사용자가 실제로 자주 사용하는 디바이스의 사양은 점점 낮아지고 있다.
	- PC > 스마트폰 > 스마트워치 > IoT 기기 > ...
 
빠른 그래픽 처리가 점점 더 많이 필요하다는 것이 WebGL을 쓰게 되는 주요인

그렇다면 WebGL은 왜 빠른가?

### 그래픽 처리 흐름

![](http://i.imgur.com/HRLJBdw.png)

WebGL 사용 시 OS계층을 타지 않고 브라우저가 바로 OpenGL을 거쳐 GPU에서 처리하므로 더 빠르다.

### GPU 병렬 처리

- CPU : 고성능 but 적은 core 수(1, 2, 4)

- GPU : 저성능 but 엄청 많은 core 수(수백만~수천만)

- 픽셀이 백만개라면 
	- CPU는 빨리 백만개의 픽셀에 점을 찍고
	- GPU는 백만개가 각각 하나의 픽셀에 점을 찍는다.
	
- 그냥 한 판 그리는 거면 몰라도 애니메이션, 조명 처리 등이 들어가면 GPU의 승리

## 병렬 프로그래밍

GPU가 병렬적으로 처리할 수 있으려면 **백만개의 점을 찍는 과정이 서로 격리되어 독립적이어야 한다.**

### 독립적

>1 + 3을 계산하여 4를 얻고 5 + 7을 계산해서 12를 얻는다고 하자.

이 두 번의 덧셈 계산은 서로 아무런 영향을 주지 않는 독립적인 계산이다.
따라서 1번 코어에는 1+3을 계산시키고, 2번 코어에는 5+7을 계산시켜서 병렬적으로 처리할 수 있다.

>(1 + 2) + 5 를 계산한다고 하자.

이 두 번의 덧셈 계산을 하려면 (1 + 2)가 반드시 먼저 선행해야 한다는 제약이 있다.
이런 상황에서는 1번 코어에 (1 + 2)를 계산시키고, 2번 코어에 + 7을 계산시키는 방식으로 병렬적으로 처리할 수 없다.

### 무상태

- 어떤 하나의 상태를 여럿이 공유하고, 여럿 중의 하나가 상태를 변경할 수 있다면 서로 독립적일 수 없다.
- 따라서 병렬 프로그래밍을 하려면 상태를 사용하지 않는 순수한 수학적 함수가 필요하다.
- 순수한 수학적 함수를 프로그래밍의 언어로 표현하면 지역 변수, 인자만을 사용하는 함수를 의미한다.

### 절반만 빨간색 CPU vs GPU

화면의 우측 절반만 빨간색으로 칠하는 작업을 CPU 방식과 GPU 방식으로 비교해보자.

#### CPU 방식

```
function
	for (y ~~~)
    	for (x ~~~)
    	    if (x > 50%)
				paint RED
```

위와 같이 CPU가 루프를 돌면서 각 픽셀에 대해 처리

### GPU 방식

```
function
    if (x > 50%)
        paint RED    
```

위의 함수를 각각의 GPU 코어가 병렬적으로 자기 픽셀에 대해 1회 처리 

## CPU와 GPU의 의사소통

- GPU는 그리기만 할 뿐 사용자와의 인터랙션, 이벤트 처리 등에 대해서는 전혀 모름

- 이런 정보는 CPU가 접수해서 버스를 통해 GPU에 전달해야함

- 프로그래밍 적으로는 CPU가 관장하는 Canvas에서 gl 컨텍스트를 가져오고 gl 컨텍스트를 활용하여 GPU에 전달 

- 전달 비용이 비싸므로 버스 한 번 태울때마다 가능한 최적화해서 많이 담고 전달 회수를 줄여야 함

## 용어 정리

### 파이프라인

#### hook

### 버텍스

### 래스터라이즈

### 프래그먼트

### 잠깐 용어 정리

### 그래픽 처리 전략

#### reflow - Vertex Shader

#### repaint - Fragment Shader

### 영역 계산 방식

#### 상대값 기준

#### 절대값 기준 
